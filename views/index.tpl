<!DOCTYPE html>

<html>
<head>
  <title>look</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" />
<style type="text/css">
@charset "utf-8";
/* CSS Document */
BODY, H1, H2, H3, H4, H5, H6, HR, P, BLOCKQUOTE, DL, DT, DD, UL, OL, LI, PRE, FORM, FIELDSET, LEGEND, BUTTON, TEXTAREA, LABEL {
	padding:0px;
	margin:0px;
	border:0px;
 	font-size:12px;
	color:#7b7b7b;
}
UL {
	LIST-STYLE-TYPE: none;
	LIST-STYLE-IMAGE: none
}
OL {
	LIST-STYLE-TYPE: none;
	LIST-STYLE-IMAGE: none
}
a{
 
	TEXT-DECORATION: none;
  font-size:14px
}
 
 
div {
	 font-size:14px;
	 font-family:'微软雅黑';
}
img {
	border:0 none
}
li {
	list-style-type:none
}
</style>

<body ng-app="monitor">
<div>
	<div class="panel panel-info">
	   <div class="panel-heading">
	      <h3 class="panel-title">电脑1</h3>
	   </div>
	   	<div class="panel-body">
		
	<div style="width:1024px; margin:0 auto;">
	<div  contenteditable="true" style="-moz-border-radius: 4px;-khtml-border-radius: 4px;-webkit-border-radius: 4px;border-radius: 4px; color:#d7d7d7; font-size:16px; text-align:center; background:url(static/img/bgt.png) repeat ; padding:5px 0px; "><div style="float:left; padding-left:10px;"><font id="sid" color="red"></font></div><div style="float:right; padding-right:10px;"><font id="bid" color="red"></font></div><div style=" clear:both;"></div></div>

	  <div class="xiangmu" style="-moz-border-radius: 6px;-khtml-border-radius: 6px;-webkit-border-radius: 6px;border-radius: 6px;   background:url(static/img/bgt.png) repeat ; padding:5px; margin-bottom:10px;">
	    
	    <div style=" text-align:center;  color:#d7d7d7;">
	      <div style="float:left; width:113px;">返回验证码 </div>
	      <div style="float:left; width:180px; margin-left:34px;">提交用户名和密码信息</div>
	      <div style="float:left; width:180px;">返回手机验证码</div>
	      <div style="float:left; width:180px;">提交手机验证码</div>
	      <div style="float:left; width:180px;">返回登录成功</div>
	      <div style="float:left; width:130px; text-align:left; text-indent:60px;">返回流水</div>
	      <div style=" clear:both;"></div>
	    </div>
	    <div style=" clear:both;"></div>
	  </div>
	  <div class="xiangmu" style="-moz-border-radius: 6px;-khtml-border-radius: 6px;-webkit-border-radius: 6px;border-radius: 6px;   background:url(static/img/bgt.png) repeat ; padding:5px; margin-bottom:10px;">
	    <div style=" background:url(static/img/index_05.png) no-repeat; width:970px; height:67px; padding:14px 11px; margin:0px auto 0 auto;">
	      <div class="c1" style=" width:40px; height:40px; float:left; cursor:pointer;"></div>
	      <div class="bfb1" style=" width:140px; height:27px; float:left; padding-top:13px;  "><img style=" height:13px; display:block;" src="static/img/1.png"></div>
	      <div class="c2" style=" width:40px; height:40px; float:left; cursor:pointer;"></div>
	      <div class="bfb2" style=" width:140px; height:40px; float:left;  padding-top:13px;  "><img style=" height:13px; display:block;" src="static/img/2.png"></div>
	      <div class="c3" style=" width:40px; height:40px; float:left; cursor:pointer;"></div>
	      <div  class="bfb3" style=" width:140px; height:40px; float:left;   padding-top:13px;  "><img style=" height:13px; display:block;" src="static/img/3.png"></div>
	      <div class="c4" style=" width:40px; height:40px; float:left; cursor:pointer;"></div>
	      <div  class="bfb4" style=" width:140px; height:40px; float:left;   padding-top:13px;  "><img style=" height:13px; display:block;" src="static/img/4.png"></div>
	      <div class="c5" style=" width:40px; height:40px; float:left; cursor:pointer;"></div>
	      <div  class="bfb5" style=" width:140px; height:40px; float:left;  padding-top:13px;  "><img style=" height:13px; display:block;" src="static/img/5.png"></div>
	      <div class="c6" style=" width:40px; height:40px; float:left; cursor:pointer;"></div>
	      <div style=" clear:both;"></div>
	    </div>
	    <div class="miaoshu" style=" position:relative; ">
		    <div class="miaoshu1"  style="  margin-left:13px;-moz-border-radius: 11px;-khtml-border-radius: 11px;-webkit-border-radius: 11px;border-radius: 11px;  background:url(static/img/bgt.png) repeat ; padding:10px; display:inline-block;width:225px; height:auto;  position:absolute; top:10px; left:-18px;" >	
				进度： <span  class="span1" contenteditable="true" style="">0</span><font>%</font><br>
			</div>
		    <div class="miaoshu2"   style="  margin-left:13px;-moz-border-radius: 11px;-khtml-border-radius: 11px;-webkit-border-radius: 11px;border-radius: 11px;  background:url(static/img/bgt.png) repeat ; padding:10px; display:inline-block;width:225px; height:auto;  position:absolute; top:10px; left:105px;" > 
		    	进度： <span  class="span2" contenteditable="true" style="">0</span><font>%</font><br>
			</div>
		    <div class="miaoshu3"   style="  margin-left:13px;-moz-border-radius: 11px;-khtml-border-radius: 11px;-webkit-border-radius: 11px;border-radius: 11px;  background:url(static/img/bgt.png) repeat ; padding:10px; display:inline-block;width:225px; height:auto;  position:absolute; top:10px; left:290px;" > 
		    	进度： <span contenteditable="true" style="" class="span3">0</span><font>%</font><br>
		    </div>
		      
		    <div class="miaoshu4"  style="  margin-left:13px;-moz-border-radius: 11px;-khtml-border-radius: 11px;-webkit-border-radius: 11px;border-radius: 11px;  background:url(static/img/bgt.png) repeat ; padding:10px; display:inline-block;width:225px; height:auto;  position:absolute;  top:10px; left:470px;" > 
		      	进度： <span contenteditable="true" style="" class="span4">0</span><font>%</font><br>
		    </div>
		    <div class="miaoshu5"  style="   margin-left:13px;-moz-border-radius: 11px;-khtml-border-radius: 11px;-webkit-border-radius: 11px;border-radius: 11px;  background:url(static/img/bgt.png) repeat ; padding:10px; display:inline-block;width:225px; height:auto;  position:absolute; top:10px; left:650px;" > 
		    	进度： <span contenteditable="true" style="" class="span5">0</span><font>%</font><br>
		    </div>
		    <div class="miaoshu6"   style="   margin-left:13px;-moz-border-radius: 11px;-khtml-border-radius: 11px;-webkit-border-radius: 11px;border-radius: 11px;  background:url(static/img/bgt.png) repeat ; padding:10px; display:inline-block;width:225px; height:auto;  position:absolute; top:10px; left:762px;" > 
		    	项目总结： 
		    </div>
		    <div style=" clear:both;"></div>
		  </div>
		  <div style=" clear:both;"></div>
	  </div>
	  
	</div>

		</div>
	   </div>
	</div>
</div>
<div ng-controller="computers">
	<computer ng-repeat="computer in computers"></computer>
</div>
</body>
<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
<script src="//cdn.bootcss.com/angular.js/1.5.7/angular.min.js"></script>
<script type="text/javascript">

var monitor = angular.module('monitor', []);
monitor.directive('computer', function() {
    return {
        restrict: 'E',
        templateUrl: '/static/computer.html',
        replace: true,
        link:function(scope, el, attr) {  
        	$(".miaoshu div").css("display","none");

        	for (var i = 6; i > 0; i--) {
        		$(".bfb"+i+" img").animate({width:+"0px"})	
        	}
        	
            scope.showDetails =   function(event,i){
				$(event.target).parent().parent().find(".miaoshu .miaoshu"+i).toggle(500).siblings().fadeOut();
			}
        }
    };
});

monitor.service( 'computer', [ '$rootScope', function( $rootScope ) {
    var service = {
      	computers: [],
      	addBook: function (data) {
      		if (this.computers.length == 0) {
      				var one = newComputer(data.pc_id)
					one.receiveData(data.bank_status)
					this.computers.push(one)
      		}else{
      			var nowComputer = undefined
	        	for (var i = this.computers.length - 1; i >= 0; i--) {
					if(data.pc_id == this.computers[i].cid){
						nowComputer = i 
					}
				}
				if (nowComputer != undefined) {
					this.computers[nowComputer].receiveData(data.bank_status)
				}else{
						var one = newComputer(data.pc_id)
						one.receiveData(data.bank_status)
						this.computers.push(one)
				}
			}
        	$rootScope.$broadcast( 'computers.update' );
      	}
    }
    var websocket = new WebSocket("ws://{{.ip}}:8080/ws");
	websocket.onopen = function(evt) { 
            alert('websocket连接成功') 
        }; 
    websocket.onclose = function(evt) { 
            alert('websocket断开连接') 
        }; 
    websocket.onmessage = function(evt) {
			service.addBook(JSON.parse(evt.data))
        }; 
    websocket.onerror = function(evt) { 
            alert('websocket出现错误') 
        }; 
    return service
}]);

monitor.controller('computers',['$scope','computer',function($scope,computer){

	$scope.$on( 'computers.update', function( event ) {
        $scope.computers = computer.computers;
        $scope.$apply();
    }); 

	$scope.computers = computer.computers  //[newComputer("1234")]

	$scope.showDetails = function(){
		$(this).parent().parent().find(".miaoshu .miaoshu2").toggle(500).siblings().fadeOut();
	}

	
}])



	var showDetails =   function(event,i){
            	var oo = $(event.target)
            	var o1 = oo.parent().parent()
            	var o2 = o1.find(".miaoshu .miaoshu2")
				jQuery(event.target).parent().parent().find(".miaoshu .miaoshu"+i).toggle(500).siblings().fadeOut();
			}
	
	/*var websocket = new WebSocket("ws://{{.ip}}:8080/ws");
	
	websocket.onopen = function(evt) { 
            alert('websocket连接成功') 
        }; 
    websocket.onclose = function(evt) { 
			alert(evt)
            alert('websocket断开连接') 
        }; 
    websocket.onmessage = function(evt) {
			onMessage(evt.data)
        }; 
    websocket.onerror = function(evt) { 
			alert(evt)
            alert('websocket出现错误') 
        }; */
		
	var onMessage = function(data){
			computer.receiveData(data)
	}	
		

	var newComputer = function(cid){
		var computer = {
			s:0,
			cid:cid,
			sid:null,
			bid:null,
			hository:new Array(6),
			receiveData : function(data){
				if (typeof data == 'string'){
					var data = JSON.parse(data)
				}
				if(data.step == 0 || this.sid != data.sid){
						this.sid = data.sid
						this.bid = data.bid
						$('#sid').html(data.sid)
						$('#bid').html(data.bid)
						this.hository = new Array(6)
						this.initFlowSheet()
					}
				this.s = data.step
				this.hository[data.step] = data
				this.loadBegin()
				this.startStep(88)
				this.loadMessage()
			},
			startStep : function(bfb){
				var i = this.s
				$(".miaoshu"+i+" .span"+i).text(bfb);
				w =bfb*140/100;
				$(".bfb"+ i +" img").animate({width:w+"px"},bfb*100)
			},
			loadBegin : function(){
				for(i=0;i<this.s;i++){
					$(".bfb"+i+" img").stop(true,true);
					$(".bfb"+i+" img").animate({width:140+"px"},"fast")
					$(".miaoshu"+i+" .span"+i).text(100);
				}
			},
			loadMessage : function(){
	
				for(var i = 0 ; i <= 6 ; i++){
					var data = this.hository[i]
					var html = '<font>%</font>'
					if(data == undefined){
	
					}else{
						for (var j in data){
							if(j == 'step'){
								
							}else{
							html += '<br><span contenteditable="true" ><font color="#030303">'+j+'</font> : <font color="#EE4000">'+data[j]+'</font></span>'
						}
					}
				}
					$(".miaoshu"+i+" .span"+i).nextAll().remove();
					$(".miaoshu"+i+" .span"+i).after(html);
				}
			},
			initFlowSheet : function(){
			
				for(var i=1 ; i<=6 ; i++){
					$(".miaoshu"+i+" .span"+i).text(0);
				}
				
				var bfb = $(".miaoshu1 .span1").text();
				 bfb =bfb*140/100;
				$(".bfb1 img").animate({width:bfb+"px"})
				
			 	var bfb = $(".miaoshu2 .span2").text();
				 bfb =bfb*140/100;
				$(".bfb2 img").animate({width:bfb+"px"})
				
				var bfb = $(".miaoshu3 .span3").text();
				 bfb =bfb*140/100;
				$(".bfb3 img").animate({width:bfb+"px"})
				
				var bfb = $(".miaoshu4 .span4").text();
				 bfb =bfb*140/100;
				$(".bfb4 img").animate({width:bfb+"px"})
				
				var bfb = $(".miaoshu5 .span5").text();
				 bfb =bfb*140/100;
				$(".bfb5 img").animate({width:bfb+"px"})
				
				var bfb = $(".miaoshu6 .span6").text();
				 bfb =bfb*140/100;
				$(".bfb6 img").animate({width:bfb+"px"})
			}
	}
		return computer
	}

	var computer = newComputer("test")
	

</script>
<script>
<!--tabjs begin-->
 $(function(){
	 $(".miaoshu div").css("display","none");
	 $(".c1").click(function(){
		 $(this).parent().parent().find(".miaoshu .miaoshu1").toggle(500).siblings().fadeOut();
		 })
	  $(".c2").click(function(){
		 $(this).parent().parent().find(".miaoshu .miaoshu2").toggle(500).siblings().fadeOut();
		 })
	 $(".c3").click(function(){
		 $(this).parent().parent().find(".miaoshu .miaoshu3").toggle(500).siblings().fadeOut();
		 })
	 $(".c4").click(function(){
		 $(this).parent().parent().find(".miaoshu .miaoshu4").toggle(500).siblings().fadeOut();
		 })
	 $(".c5").click(function(){
		 $(this).parent().parent().find(".miaoshu .miaoshu5").toggle(500).siblings().fadeOut();
		 })
		 
		 $(".c6").click(function(){
		 $(this).parent().parent().find(".miaoshu .miaoshu6").toggle(500).siblings().fadeOut();
		 }) 
	
	 computer.initFlowSheet()
 
	
    <!--点击进度条调整进度_调整数字改变进度 begin-->
	 /*$(".bfb1").click(function(e){
		 $(this).parent().parent().find(".miaoshu .miaoshu1").fadeIn().siblings().fadeOut();
		 x=$(this).offset();
	     var ep =   e.pageX - x.left;
	     $(".bfb1 img").animate({width:ep+"px"},3000);
		 var bfb = $(".miaoshu1 .span1").text();
		 bfb = ep*100/140;
		 $(".miaoshu1 .span1").text(parseInt(bfb));
	})
     $(".miaoshu1 .span1").blur(function(){
	 	var bfb = $(".miaoshu1 .span1").text();	 
		bfb =bfb*140/100;	
		$(".bfb1 img").animate({width:bfb+"px"},3000);
	})
		 
     $(".bfb2").click(function(e){
		 $(this).parent().parent().find(".miaoshu .miaoshu2").fadeIn().siblings().fadeOut();
			x=$(this).offset();
		     var ep =   e.pageX - x.left;
		     $(".bfb2 img").animate({width:ep+"px"});
			 var bfb = $(".miaoshu2 .span2").text();
			 bfb = ep*100/140;
			 $(".miaoshu2 .span2").text(parseInt(bfb));
		})
     $(".miaoshu2 .span2").blur(function(){
	 	var bfb = $(".miaoshu2 .span2").text();	 
		bfb =bfb*140/100;	
		$(".bfb2 img").animate({width:bfb+"px"});
	})
		 
	$(".bfb3").click(function(e){
		$(this).parent().parent().find(".miaoshu .miaoshu3").fadeIn().siblings().fadeOut();
			  x=$(this).offset();
     var ep =   e.pageX - x.left;
     $(".bfb3 img").animate({width:ep+"px"});
	 var bfb = $(".miaoshu3 .span3").text();
	 bfb = ep*100/140;
	 $(".miaoshu3 .span3").text(parseInt(bfb));
			 })
     $(".miaoshu3 .span3").blur(function(){
	 var bfb = $(".miaoshu3 .span3").text();	 bfb =bfb*140/100;	$(".bfb3 img").animate({width:bfb+"px"});
		 })
		 
	 $(".bfb4").click(function(e){
		 $(this).parent().parent().find(".miaoshu .miaoshu4").fadeIn().siblings().fadeOut();
			  x=$(this).offset();
     var ep =   e.pageX - x.left;
     $(".bfb4 img").animate({width:ep+"px"});
	 var bfb = $(".miaoshu4 .span4").text();
	 bfb = ep*100/140;
	 $(".miaoshu4 .span4").text(parseInt(bfb));
			 })
     $(".miaoshu4 .span4").blur(function(){
	 var bfb = $(".miaoshu4 .span4").text();	 bfb =bfb*140/100;	$(".bfb4 img").animate({width:bfb+"px"});
		 })
		 
		 
	 $(".bfb5").click(function(e){
		 $(this).parent().parent().find(".miaoshu .miaoshu5").fadeIn().siblings().fadeOut();
			  x=$(this).offset();
     var ep =   e.pageX - x.left;
     $(".bfb5 img").animate({width:ep+"px"});
	 var bfb = $(".miaoshu5 .span5").text();
	 bfb = ep*100/140;
	 $(".miaoshu5 .span5").text(parseInt(bfb));
			 })
     $(".miaoshu5 .span5").blur(function(){
	 var bfb = $(".miaoshu5 .span5").text();	 bfb =bfb*140/100;	$(".bfb5 img").animate({width:bfb+"px"});
		 })
		 
	$(".bfb6").click(function(e){
		$(this).parent().parent().find(".miaoshu .miaoshu6").fadeIn().siblings().fadeOut();
			  x=$(this).offset();
     var ep =   e.pageX - x.left;
     $(".bfb6 img").animate({width:ep+"px"});
	 var bfb = $(".miaoshu6 .span6").text();
	 bfb = ep*100/140;
	 $(".miaoshu6 .span6").text(parseInt(bfb));
			 })
     $(".miaoshu6 .span6").blur(function(){
	 var bfb = $(".miaoshu6 span6").text();	 bfb =bfb*140/100;	$(".bfb6 img").animate({width:bfb+"px"});
		 })*/
		 
	 
		  })
</script>

</html>
